# Refactor monolith to microservices

This workspace will show how to refactor a Java EE monolith to a
microservices-based application. This will be accomplished in multiple
phases:

. Phase 1: Functional decomposition of a `WAR` into multiple `WAR`s. Use hardcoded service URIs.
. Phase 2: Use service registration and discovery
. Phase 3: Continuous integration
. Phase 4: Continuous deployment
. Phase 5: Proactive monitoring and scale in/out
. Phase 6: Change the implementation stack of a service

## Run the application

. Start ZooKeeper

  docker run -d -p 2181:2181 fabric8/zookeeper

. Download and unzip http://download.jboss.org/wildfly/9.0.0.Final/wildfly-9.0.0.Final.zip[WildFly 9.0.0.Final]
. Run WildFly

  ./bin/standalone.sh

. Deploy the application

  mvn -f microservice/pom.xml install -DskipTests
  
## Run the application with KumuluzEE

. Start ZooKeeper

  docker run -d -p 2181:2181 fabric8/zookeeper
  
. Build the microservices (each microservice will be its own standalone service with all the required dependencies packaged in)

  mvn clean package
  
. Run each microservice separately. This is to show that each microservice is indeed its own independed service. Make sure to adjust the ports of the microservices so that they don't collide (use the PORT environment variable).

  $ java -cp catalog/target/classes:catalog/target/dependency/* com.kumuluz.ee.EeApplication
  $ PORT=8081 java -cp order/target/classes:order/target/dependency/* com.kumuluz.ee.EeApplication
  $ PORT=8082 java -cp user/target/classes:user/target/dependency/* com.kumuluz.ee.EeApplication
  $ PORT=8083 java -cp everest/target/classes:everest/target/dependency/* com.kumuluz.ee.EeApplication
  
. Alternatively you can start the microservices using maven by running the following command inside a specific microservice folder: (Starting them all together with maven is a bit difficult as the microservices are normall apps that run in the foreground and wait, which means that maven will stop on the first one)

  $ mvn exec:java

## NoOps

Operational concerns are addressed in the following documents:

. link:service-discovery.adoc[Service Discovery]
. Continuous Integration
. Continuous Deployment
. link:service-monitoring.adoc[Service Monitoring]

